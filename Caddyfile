# {
#   auto_https off
# }

# Admin site (static files) + API proxy
https://admin.sibgpt.app {
  root * /srv/admin-ui
  encode gzip zstd

  # Proxy API calls to backend service (preserve path)
  handle /api/* {
    reverse_proxy app:8080
  }

  # Grafana on a sub-path (do NOT strip prefix; Grafana expects /monitor)
  handle /monitor/* {
    reverse_proxy grafana:3000
  }

  # Serve SPA and fallback to index.html for client-side routing
  handle {
    try_files {path} /index.html
    file_server
  }
}

https://payment.sibgpt.app {
  root * /srv/admin-ui
  encode gzip zstd

  handle /api/* {
    reverse_proxy app:8080
  }

  # Serve SPA and fallback to index.html for client-side routing
  handle {
    try_files {path} /index.html
    file_server
  }
}